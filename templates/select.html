{% extends "layout.html" %}

{% block title %}
    Select Game
{% endblock %}

{% block body %}
<div class="center">
    <div class="form-panel">
        {% if message %}
        <div class="error-message">{{ message }}</div>
        {% else %}
        <div class="message">Select a Game and Download Method</div>
        {% endif %}
        <div class="form-container">
            <form action="/links" method="post">
                <div class="select-container">
                    <select name="game" id="game-select">
                        {% for game in games %}
                        <option value="{{ game.biz }}" data-pre="{{ game.pre }}">{{ game.game }}</option>
                        {% endfor %}
                    </select>
                    <select name="pre" id="pre-select">
                        <option value="no" selected>Main Download</option>
                        <option value="yes" disabled class="disabled-option">No Pre-Installation</option>
                    </select>
                </div>
                <input type="submit">
            </form>
        </div>
    </div>
</div>


<script>
    function updatePreOptions() {
        const gameSelect = document.getElementById('game-select');
        const preSelect = document.getElementById('pre-select');
        const selectedOption = gameSelect.options[gameSelect.selectedIndex];
        const hasPre = selectedOption.getAttribute('data-pre').toLowerCase() === 'true';
        
        // Remove existing options
        while (preSelect.firstChild) {
            preSelect.removeChild(preSelect.firstChild);
        }
        
        if (hasPre) {
            // Add pre-installation first, then main download
            const preOption = document.createElement('option');
            preOption.value = 'yes';
            preOption.textContent = 'Pre-Installation';
            
            const mainOption = document.createElement('option');
            mainOption.value = 'no';
            mainOption.textContent = 'Main Download';
            
            preSelect.appendChild(preOption);
            preSelect.appendChild(mainOption);
            preSelect.value = 'yes';
        } else {
            // Add main download first, then disabled pre-installation
            const mainOption = document.createElement('option');
            mainOption.value = 'no';
            mainOption.textContent = 'Main Download';
            
            const preOption = document.createElement('option');
            preOption.value = 'yes';
            preOption.textContent = 'No Pre-Installation';
            preOption.disabled = true;
            preOption.classList.add('disabled-option');
            
            preSelect.appendChild(mainOption);
            preSelect.appendChild(preOption);
            preSelect.value = 'no';
        }
    }

    // Initialize options on page load
    document.addEventListener('DOMContentLoaded', updatePreOptions);

    // Update options when the game selection changes
    document.getElementById('game-select').addEventListener('change', updatePreOptions);
</script>

{% endblock %}
