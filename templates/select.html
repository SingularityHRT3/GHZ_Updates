{% extends "layout.html" %}

{% block title %}
    Select Game
{% endblock %}

{% block body %}
<div class="center">
    <div class="form-panel">
        {% if message %}
        <div class="error-message">{{ message }}</div>
        {% else %}
        <div class="message">Select a Game and Download Method</div>
        {% endif %}
        <div class="form-container">
            <form action="/links" method="post">
                <div class="select-container">
                    <select name="game" id="game-select">
                        {% for game in games %}
                        <option value="{{ game.biz }}" data-pre="{{ game.pre }}">{{ game.game }}</option>
                        {% endfor %}
                    </select>
                    <select name="pre" id="pre-select">
                        <option value="no" selected>Main Download</option>
                        <option value="yes" disabled class="disabled-option">No Pre-Installation</option>
                    </select>
                </div>
                <input type="submit">
            </form>
        </div>
    </div>
</div>


<script>
    function updatePreOptions() {
        const gameSelect = document.getElementById('game-select');
        const preSelect = document.getElementById('pre-select');
        const selectedOption = gameSelect.options[gameSelect.selectedIndex];
        const hasPre = selectedOption.getAttribute('data-pre').toLowerCase() === 'true';
        
        if (hasPre) {
            // Enable pre-installation option
            const preOption = preSelect.querySelector('option[value="yes"]');
            preOption.disabled = false;
            preOption.classList.remove('disabled-option');
            preOption.textContent = "Pre-Installation";
            
            // Default to pre-installation
            preSelect.value = "yes";
        } else {
            // Disable pre-installation option
            const preOption = preSelect.querySelector('option[value="yes"]');
            preOption.disabled = true;
            preOption.classList.add('disabled-option');
            preOption.textContent = "No Pre-Installation";
            
            // Force main download option
            preSelect.value = "no";
        }
    }

    // Initialize options on page load
    document.addEventListener('DOMContentLoaded', updatePreOptions);

    // Update options when the game selection changes
    document.getElementById('game-select').addEventListener('change', updatePreOptions);
</script>

{% endblock %}
