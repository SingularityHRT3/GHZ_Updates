{% extends "layout.html" %}

{% block title %}
    Select Game
{% endblock %}

{% block body %}
<div class="center">
    <div class="form-panel">
        {% if message %}
        <div class="error-message">{{ message }}</div>
        {% else %}
        <div class="message">Select a Game and Download Method</div>
        {% endif %}
        <div class="form-container">
            <form action="/links" method="post">
                <div class="select-container">
                    <select name="game">
                        {% for game in games %}
                        <option value="{{ game.biz }}" data-pre="{{ game.pre|default(false) }}">{{ game.game }}</option>
                        {% endfor %}
                    </select>
                    <select name="pre" id="pre-select">
                        <option value="no" selected>Main Download</option>
                        <option value="yes" disabled class="disabled-option">No Pre-Installation</option>
                    </select>
                </div>
                <input type="submit">
            </form>
        </div>
    </div>
</div>

<script>
    function updatePreOptions() {
        const gameSelect = document.getElementById('game-select');
        const preSelect = document.getElementById('pre-select');
        const selectedGame = gameSelect.options[gameSelect.selectedIndex];
        const hasPre = selectedGame.getAttribute('data-pre') === 'true';

        if (hasPre) {
            preSelect.innerHTML = `
                <option value="yes" selected>Pre-Installation</option>
                <option value="no">Main Download</option>
            `;
        } else {
            preSelect.innerHTML = `
                <option value="no" selected>Main Download</option>
                <option value="yes" disabled>No Pre-Installation</option>
            `;
        }
    }

    // Initialize options on page load
    document.addEventListener('DOMContentLoaded', updatePreOptions);
</script>

{% endblock %}
